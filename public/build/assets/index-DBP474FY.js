import{p as h,E as O,a3 as B}from"./vendor-ZmbnWLp6.js";import{a as P,s as k}from"./main-H3fHEa0S.js";function j(){var a=/^\d+$/,l=/^\d{10,11}$/,o=/^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$/;return{checkNumber:r=>a.test(r),checkPhoneNumber:r=>l.test(r),checkEmail:r=>o.test(r)}}function K(){const a=P.baseURL,l=h({phone:"",password:"",type:"api"}),o=h({status:!1}),m=h({status:!1}),t=h({phone:"",password:"",confirmPassword:"",referral_code:"",name:"",email:"",errorLogin:""}),{checkNumber:E,checkPhoneNumber:r,checkEmail:y}=j(),p=(e,s,n)=>{$({icon:e,html:s,showConfirmButton:n})},b=O(),$=B("$swal"),f=e=>(e.response?(console.error("Server responded with a status:",e.response.status),console.error("Response data:",e.response.data)):e.request?console.error("No response received:",e.request):console.error("Error setting up the request:",e.message),e),I=async e=>{let s=!0;return t.confirmPassword="",t.phone="",t.password="",t.name="",t.email="",t.referral_code="",t.errorLogin="",e.name==""&&(t.name="Họ và tên không để trống!",s=!1),e.email==""?(t.email="Email không để trống!",s=!1):y(e.email)||(t.email="Email sai định dạng!",s=!1),e.phone==""?(t.phone="Số điện thoại không để trống!",s=!1):r(e.phone)||(t.phone="Số điện thoại sai định dạng!",s=!1),e.password==""?(t.password="Mật khẩu không để trống!",s=!1):e.password.length<8&&(t.password="Mật khẩu ít hơn 8 ký tự!",s=!1),e.confirmPassword==""?(t.confirmPassword="Mật khẩu xác nhận không để trống!",s=!1):e.confirmPassword.length<8?(t.confirmPassword="Mật khẩu xác nhận ít hơn 8 ký tự!",s=!1):e.confirmPassword!=e.password&&(t.confirmPassword="Mật khẩu xác nhận không chính xác!",s=!1),e.referral_code===""&&(t.referral_code="Mã giới thiệu không để trống!",s=!1),t.errorLogin="",s};setTimeout(function(){m.status==!0&&localStorage.removeItem("user")},3e5);const A=async(e,s)=>{const n=await I(e);if(n==!1){o.status=!1;return}if(n==!0&&(o.status=!0),s=="sendotp"){o.status=!0,m.status=!0;try{const c=Math.floor(Math.random()*9e5),u={...e,otp:c},i=await axios.post(`${a}send-otp`,u);if(i.data.status==="success"){var g=JSON.stringify(i.data.data),w=btoa(encodeURIComponent(g));localStorage.setItem("user",g),p("success","Đã gửi mã OTP về email của bạn",!1)}}catch(c){if(o.status=!1,c.response&&c.response.data&&c.response.data.message){const i=Object.keys(c.response.data.message)[0];i==="phone"?t.phone="Số điện thoại đã tồn tại":i==="email"&&(t.email="Email đã tồn tại")}}}if(s=="register"){var w=localStorage.getItem("user");if(!w)return;var L=JSON.parse(w);if(L.otp===parseInt(e.otp))try{(await axios.post(`${a}register`,e)).data.status==="success"&&(p("success","Đăng ký thành công",!0),window.location.href=`${P.URL}/affilate/login`)}catch(u){o.status=!1;const x=Object.keys(u.response.data.message)[0];x==="phone"?t.phone="Số điện thoại đã tồn tại":x==="email"&&(t.email="Email đã tồn tại")}else p("error","OTP error!",!0)}},M=async e=>{let s=!0;t.phone="",t.password="";var n=/^[+-]?\d+(\.\d+)?$/,g=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;return e.phone==""?(t.phone="Tài khoản không để trống!",s=!1):n.test(e.phone)?r(e.phone)||(t.phone="Số điện thoại sai định dạng!",s=!1):g.test(e.phone)?y(e.phone)||(t.phone="Email không đúng định dạng",s=!1):(t.phone="Tài khoản không hợp lệ!",s=!1),e.password==""?(t.password="Mật khẩu không để trống!",s=!1):e.password.length<8&&(t.password="Mật khẩu ít hơn 8 ký tự!",s=!1),s},N=async()=>{if(await M(l)!=!1)try{const s=await axios.post(`${a}auth/login`,l,{headers:d});if(console.log(s.data.role),s.data.status==="error"||s.data.role==="Admin"){p("error","Thông tin không chính xác",!0);return}s.data.status=="success"&&(await k.dispatch("setTokenUser",{token:s.data.accessToken}),await k.dispatch("getUser"),await b.push({name:"dashboard"}))}catch(s){console.error(s),t.errorLogin="Tài khoản hoặc mật khẩu không chính xác"}},R=async()=>{const e={accept:"application/json",Authorization:"Bearer "+localStorage.getItem("token")};try{const{data:s}=await axios.post(`${a}auth/logout `,{},{headers:e});s.status=="success"&&(await k.dispatch("logout"),await b.push({name:"login"}))}catch({res:s}){await k.dispatch("logout")}},d={accept:"application/json",Authorization:"Bearer "+localStorage.getItem("token")},T=async e=>{try{const s=await axios.post(`${a}/auth/edit-user-info`,{id:e},{headers:d})}catch(s){throw f(s)}},U=h({phone:"",name:"",address:""}),_=async e=>{try{const s=await axios.post(`${a}edit-user`,e,{headers:d})}catch(s){throw f(s)}},v=h({data:[]});return{loginForm:l,submitLogin:N,logout:R,errors:t,resultOtp:o,submitResgiter:A,editUserInfo:T,editUser:_,FormEdituser:U,getBank:async()=>{try{const e=await axios.get(`${a}get-bank`,{headers:d});e.status===200&&(v.data=e.data.data)}catch(e){throw f(e)}},responseBank:v,updateUserInfo:async e=>{try{const s=await axios.post(`${a}update-user-info`,{FormUserInfo:e},{headers:d});console.log(s)}catch(s){throw f(s)}}}}export{K as A};
