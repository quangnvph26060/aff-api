import{p as l,E as R,a1 as _}from"./vendor-bE65uGJm.js";import{a as P,s as p}from"./main-Drxgvcuo.js";function j(){var o=/^\d+$/,i=/^\d{10,11}$/,r=/^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$/;return{checkNumber:n=>o.test(n),checkPhoneNumber:n=>i.test(n),checkEmail:n=>r.test(n)}}function q(){const o=P.baseURL,i=l({phone:"",password:"",type:"api"}),r=l({status:!1}),f=l({status:!1}),t=l({phone:"",password:"",confirmPassword:"",referral_code:"",name:"",email:""}),{checkNumber:b,checkPhoneNumber:n,checkEmail:v}=j(),u=(e,s,a)=>{A({icon:e,html:s,showConfirmButton:a})},w=R(),A=_("$swal"),g=e=>(e.response?(console.error("Server responded with a status:",e.response.status),console.error("Response data:",e.response.data)):e.request?console.error("No response received:",e.request):console.error("Error setting up the request:",e.message),e),E=async e=>{let s=!0;return t.confirmPassword="",t.phone="",t.password="",t.name="",t.email="",e.name==""&&(t.name="Họ và tên không để trống!",s=!1),e.email==""?(t.email="Email không để trống!",s=!1):v(e.email)||(t.email="Email sai định dạng!",s=!1),e.phone==""?(t.phone="Số điện thoại không để trống!",s=!1):n(e.phone)||(t.phone="Số điện thoại sai định dạng!",s=!1),e.password==""?(t.password="Mật khẩu không để trống!",s=!1):e.password.length<8&&(t.password="Mật khẩu ít hơn 8 ký tự!",s=!1),e.confirmPassword==""?(t.confirmPassword="Mật khẩu xác nhận không để trống!",s=!1):e.confirmPassword.length<8?(t.confirmPassword="Mật khẩu xác nhận ít hơn 8 ký tự!",s=!1):e.confirmPassword!=e.password&&(t.confirmPassword="Mật khẩu xác nhận không chính xác!",s=!1),s};setTimeout(function(){f.status==!0&&localStorage.removeItem("user")},3e5);const T=async(e,s)=>{const a=await E(e);if(a==!1){r.status=!1;return}if(a==!0&&(r.status=!0),s=="sendotp"){f.status=!0;try{const m=Math.floor(Math.random()*9e5),h={...e,otp:m},c=await axios.post(`${o}send-otp`,h);if(c.data.status==="success"){var I=JSON.stringify(c.data.data),d=btoa(I);localStorage.setItem("user",d),u("success","Đã gửi mã OTP về email của bạn",!1)}}catch(m){r.status=!1;const c=Object.keys(m.response.data.message)[0];c==="phone"?t.phone="Số điện thoại đã tồn tại":c==="email"&&(t.email="Email đã tồn tại")}}if(s=="register"){var d=localStorage.getItem("user");if(!d)return;var U=atob(d),C=JSON.parse(U);if(C.otp===parseInt(e.otp))try{(await axios.post(`${o}register`,e)).data.status==="success"&&(u("success","Đăng ký thành công",!0),window.location.href=`${P.URL}/login`)}catch(h){r.status=!1;const y=Object.keys(h.response.data.message)[0];y==="phone"?t.phone="Số điện thoại đã tồn tại":y==="email"&&(t.email="Email đã tồn tại")}else u("error","OTP error!",!0)}},O=async e=>{let s=!0;return t.phone="",t.password="",e.phone==""&&(t.phone="Tài khoản không để trống!",s=!1),e.password==""?(t.password="Mật khẩu không để trống!",s=!1):e.password.length<8&&(t.password="Mật khẩu ít hơn 8 ký tự!",s=!1),s},x=async()=>{const e=await O(i),s={"Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":["GET","POST","PUT","DELETE","OPTIONS"],"Access-Control-Allow-Headers":["Content-Type","Authorization"],"Content-Type":"application/json"};if(e!=!1)try{const a=await axios.post(`${o}auth/login`,i,{headers:s});if(console.log(a.data.role),a.data.status==="error"||a.data.role==="Admin"){u("error","Thông tin không chính xác",!0);return}a.data.status=="success"&&(await p.dispatch("setTokenUser",{token:a.data.accessToken}),await p.dispatch("getUser"),await w.push({name:"dashboard"}))}catch(a){console.error(a)}},N=async()=>{const e={accept:"application/json",Authorization:"Bearer "+localStorage.getItem("token")};try{const{data:s}=await axios.post(`${o}auth/logout `,{},{headers:e});s.status=="success"&&(await p.dispatch("logout"),await w.push({name:"login"}))}catch({res:s}){await p.dispatch("logout")}},k={accept:"application/json",Authorization:"Bearer "+localStorage.getItem("token")},M=async e=>{try{const s=await axios.post(`${o}/auth/edit-user-info`,{id:e},{headers:k})}catch(s){throw g(s)}},$=l({phone:"",name:"",address:""});return{loginForm:i,submitLogin:x,logout:N,errors:t,resultOtp:r,submitResgiter:T,editUserInfo:M,editUser:async e=>{try{const s=await axios.post(`${o}edit-user`,e,{headers:k})}catch(s){throw g(s)}},FormEdituser:$}}export{q as A};
