import{p as d,E as I,Z as M}from"./vendor-BijbZa7l.js";import{a as k,s as p}from"./main-BqPZiIID.js";function $(){var o=/^\d+$/,i=/^\d{10,11}$/,n=/^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$/;return{checkNumber:r=>o.test(r),checkPhoneNumber:r=>i.test(r),checkEmail:r=>n.test(r)}}function j(){const o=k.baseURL,i=d({phone:"",password:"",type:"api"}),n=d({status:!1}),f=d({status:!1}),t=d({phone:"",password:"",confirmPassword:"",referral_code:"",name:"",email:""}),{checkNumber:y,checkPhoneNumber:r,checkEmail:P}=$(),h=(e,s,a)=>{b({icon:e,html:s,showConfirmButton:a})},g=I(),b=M("$swal"),v=e=>(e.response?(console.error("Server responded with a status:",e.response.status),console.error("Response data:",e.response.data)):e.request?console.error("No response received:",e.request):console.error("Error setting up the request:",e.message),e),A=async e=>{let s=!0;return t.confirmPassword="",t.phone="",t.password="",t.name="",t.email="",e.name==""&&(t.name="Họ và tên không để trống!",s=!1),e.email==""?(t.email="Email không để trống!",s=!1):P(e.email)||(t.email="Email sai định dạng!",s=!1),e.phone==""?(t.phone="Số điện thoại không để trống!",s=!1):r(e.phone)||(t.phone="Số điện thoại sai định dạng!",s=!1),e.password==""?(t.password="Mật khẩu không để trống!",s=!1):e.password.length<8&&(t.password="Mật khẩu ít hơn 8 ký tự!",s=!1),e.confirmPassword==""?(t.confirmPassword="Mật khẩu xác nhận không để trống!",s=!1):e.confirmPassword.length<8?(t.confirmPassword="Mật khẩu xác nhận ít hơn 8 ký tự!",s=!1):e.confirmPassword!=e.password&&(t.confirmPassword="Mật khẩu xác nhận không chính xác!",s=!1),s};setTimeout(function(){f.status==!0&&localStorage.removeItem("user")},3e5);const E=async(e,s)=>{const a=await A(e);if(a==!1){n.status=!1;return}if(a==!0&&(n.status=!0),s=="sendotp"){f.status=!0;try{const m=Math.floor(Math.random()*9e5),l={...e,otp:m},c=await axios.post(`${o}send-otp`,l);if(console.log(c),c.data.status==="success"){var O=JSON.stringify(c.data.data),u=btoa(O);localStorage.setItem("user",u),h("success","Đã gửi mã OTP về email của bạn",!1)}}catch(m){n.status=!1;const c=Object.keys(m.response.data.message)[0];c==="phone"?t.phone="Số điện thoại đã tồn tại":c==="email"&&(t.email="Email đã tồn tại")}}if(s=="register"){var u=localStorage.getItem("user");if(!u)return;var N=atob(u),x=JSON.parse(N);if(x.otp===parseInt(e.otp))try{(await axios.post(`${o}register`,e)).data.status==="success"&&(h("success","Đăng ký thành công",!0),window.location.href=`${k.URL}/login`)}catch(l){n.status=!1;const w=Object.keys(l.response.data.message)[0];w==="phone"?t.phone="Số điện thoại đã tồn tại":w==="email"&&(t.email="Email đã tồn tại")}else h("error","OTP error!",!0)}},T=async e=>{let s=!0;return t.phone="",t.password="",e.phone==""&&(t.phone="Tài khoản không để trống!",s=!1),e.password==""?(t.password="Mật khẩu không để trống!",s=!1):e.password.length<8&&(t.password="Mật khẩu ít hơn 8 ký tự!",s=!1),s};return{loginForm:i,submitLogin:async()=>{const e=await T(i),s={"Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":["GET","POST","PUT","DELETE","OPTIONS"],"Access-Control-Allow-Headers":["Content-Type","Authorization"],"Content-Type":"application/json"};if(e!=!1)try{const a=await axios.post(`${o}auth/login`,i,{headers:s});if(console.log(a.data.role),a.data.status==="error"||a.data.role==="Admin"){h("error","Thông tin không chính xác",!0);return}a.data.status=="success"&&(await p.dispatch("setTokenUser",{token:a.data.accessToken}),await p.dispatch("getUser"),await g.push({name:"dashboard"}))}catch(a){console.error(a)}},logout:async()=>{const e={accept:"application/json",Authorization:"Bearer "+localStorage.getItem("token")};try{const{data:s}=await axios.post(`${o}auth/logout `,{},{headers:e});s.status=="success"&&(await p.dispatch("logout"),await g.push({name:"login"}))}catch({res:s}){await p.dispatch("logout")}},errors:t,resultOtp:n,submitResgiter:E,editUserInfo:async e=>{const s={accept:"application/json",Authorization:"Bearer "+localStorage.getItem("token")};try{const a=await axios.post(`${o}/auth/edit-user-info`,{id:e},{headers:s})}catch(a){throw v(a)}}}}export{j as A};
