import{p as i,E as _,a4 as j}from"./vendor-Dg8UqXFD.js";import{a as b,s as m}from"./main-B7mYjJu2.js";function z(){var o=/^\d+$/,h=/^\d{10,11}$/,r=/^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$/;return{checkNumber:n=>o.test(n),checkPhoneNumber:n=>h.test(n),checkEmail:n=>r.test(n)}}function Z(){const o=b.baseURL,h=i({phone:"",password:"",type:"api"}),r=i({status:!1}),w=i({status:!1}),t=i({phone:"",password:"",confirmPassword:"",referral_code:"",name:"",email:""}),{checkNumber:v,checkPhoneNumber:n,checkEmail:A}=z(),u=(e,s,a)=>{E({icon:e,html:s,showConfirmButton:a})},k=_(),E=j("$swal"),d=e=>(e.response?(console.error("Server responded with a status:",e.response.status),console.error("Response data:",e.response.data)):e.request?console.error("No response received:",e.request):console.error("Error setting up the request:",e.message),e),T=async e=>{let s=!0;return t.confirmPassword="",t.phone="",t.password="",t.name="",t.email="",e.name==""&&(t.name="Họ và tên không để trống!",s=!1),e.email==""?(t.email="Email không để trống!",s=!1):A(e.email)||(t.email="Email sai định dạng!",s=!1),e.phone==""?(t.phone="Số điện thoại không để trống!",s=!1):n(e.phone)||(t.phone="Số điện thoại sai định dạng!",s=!1),e.password==""?(t.password="Mật khẩu không để trống!",s=!1):e.password.length<8&&(t.password="Mật khẩu ít hơn 8 ký tự!",s=!1),e.confirmPassword==""?(t.confirmPassword="Mật khẩu xác nhận không để trống!",s=!1):e.confirmPassword.length<8?(t.confirmPassword="Mật khẩu xác nhận ít hơn 8 ký tự!",s=!1):e.confirmPassword!=e.password&&(t.confirmPassword="Mật khẩu xác nhận không chính xác!",s=!1),s};setTimeout(function(){w.status==!0&&localStorage.removeItem("user")},3e5);const x=async(e,s)=>{const a=await T(e);if(a==!1){r.status=!1;return}if(a==!0&&(r.status=!0),s=="sendotp"){w.status=!0;try{const g=Math.floor(Math.random()*9e5),l={...e,otp:g},c=await axios.post(`${o}send-otp`,l);if(c.data.status==="success"){var B=JSON.stringify(c.data.data),f=btoa(B);localStorage.setItem("user",f),u("success","Đã gửi mã OTP về email của bạn",!1)}}catch(g){r.status=!1;const c=Object.keys(g.response.data.message)[0];c==="phone"?t.phone="Số điện thoại đã tồn tại":c==="email"&&(t.email="Email đã tồn tại")}}if(s=="register"){var f=localStorage.getItem("user");if(!f)return;var C=atob(f),R=JSON.parse(C);if(R.otp===parseInt(e.otp))try{(await axios.post(`${o}register`,e)).data.status==="success"&&(u("success","Đăng ký thành công",!0),window.location.href=`${b.URL}/login`)}catch(l){r.status=!1;const P=Object.keys(l.response.data.message)[0];P==="phone"?t.phone="Số điện thoại đã tồn tại":P==="email"&&(t.email="Email đã tồn tại")}else u("error","OTP error!",!0)}},O=async e=>{let s=!0;return t.phone="",t.password="",e.phone==""&&(t.phone="Tài khoản không để trống!",s=!1),e.password==""?(t.password="Mật khẩu không để trống!",s=!1):e.password.length<8&&(t.password="Mật khẩu ít hơn 8 ký tự!",s=!1),s},N=async()=>{const e=await O(h),s={"Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":["GET","POST","PUT","DELETE","OPTIONS"],"Access-Control-Allow-Headers":["Content-Type","Authorization"],"Content-Type":"application/json"};if(e!=!1)try{const a=await axios.post(`${o}auth/login`,h,{headers:s});if(console.log(a.data.role),a.data.status==="error"||a.data.role==="Admin"){u("error","Thông tin không chính xác",!0);return}a.data.status=="success"&&(await m.dispatch("setTokenUser",{token:a.data.accessToken}),await m.dispatch("getUser"),await k.push({name:"dashboard"}))}catch(a){console.error(a)}},$=async()=>{const e={accept:"application/json",Authorization:"Bearer "+localStorage.getItem("token")};try{const{data:s}=await axios.post(`${o}auth/logout `,{},{headers:e});s.status=="success"&&(await m.dispatch("logout"),await k.push({name:"login"}))}catch({res:s}){await m.dispatch("logout")}},p={accept:"application/json",Authorization:"Bearer "+localStorage.getItem("token")},I=async e=>{try{const s=await axios.post(`${o}/auth/edit-user-info`,{id:e},{headers:p})}catch(s){throw d(s)}},M=i({phone:"",name:"",address:""}),U=async e=>{try{const s=await axios.post(`${o}edit-user`,e,{headers:p})}catch(s){throw d(s)}},y=i({data:[]});return{loginForm:h,submitLogin:N,logout:$,errors:t,resultOtp:r,submitResgiter:x,editUserInfo:I,editUser:U,FormEdituser:M,getBank:async()=>{try{const e=await axios.get(`${o}get-bank`,{headers:p});e.status===200&&(y.data=e.data.data)}catch(e){throw d(e)}},responseBank:y,updateUserInfo:async e=>{try{const s=await axios.post(`${o}update-user-info`,{FormUserInfo:e},{headers:p});console.log(s)}catch(s){throw d(s)}}}}export{Z as A};
